# vim: filetype=i3

#                                  ██ ██████
#                                  ██      ██
#                                  ██  █████
#                                  ██      ██
#                                  ██ ██████

# This file has been auto-generated by i3-config-wizard(1).
# It will not be overwritten, so edit it as you like.
#
# Should you change your keyboard layout somewhen, delete
# this file and re-run i3-config-wizard(1).
#
# i3 config file (v4)
#
# Please see http://i3wm.org/docs/userguide.html for a complete reference!

# Author: maxdevjs
# Version:1.1
# Repo: https://github.com/maxdevjs/dotfiles

# https://i3wm.org/docs/userguide.html#_layout_mode_for_new_containers
# workspace_layout default|stacking|tabbed
workspace_layout tabbed

###################################
#             actions             #
###################################

#screenshots
bindsym --release $mod+Ctrl+p exec scrot -c -d 3 screenshot-$(date +%Y-%m-%d_%T_%Z%:z_%s).png -e 'mv $f ~/Pictures/Pictures/screenshots'
bindsym --release $mod+Shift+p exec scrot -s screenshot-$(date +%Y-%m-%d_%T_%Z%:z_%s).png -e 'mv $f ~/Pictures/Pictures/screenshots'

#bindsym $mod+m [class="(?i)mpv"] floating enable   move container to output HDMI-1, move to position 0 px 0 px

bindsym $mod+m [class="(?i)mpv"] floating enable   move container to output HDMI-1, move to position 1370 px 4 px

###################################
#               apps              #
###################################

bindsym $mod+Shift+c exec gnome-calculator
for_window [title="Calculator"] floating enable

bindsym $mod+Shift+f exec nautilus --no-desktop

bindsym $mod+shift+m exec gnome-system-monitor
for_window [title="System Monitor"] move to workspace $ws10

###################################
#             assign              #
###################################

assign [title="Google Chrome"] $ws1
assign [title="Firefox"] $ws2
assign [class="Deadbeef"] $ws5
for_window [title="System Monitor"] move to workspace $ws10
for_window [title="System Settings"] move to workspace $ws10
assign [title="Filelight"] $ws10

# Processing
for_window [class="^Processing$"] move to workspace $ws3
assign [class="processing-core-PApplet"] workspace $ws3

####################################
#               bar                #
####################################

exec_always --no-startup-id $HOME/dotfiles/wms/commons/panel/polybar/polybar-launch

#bindsym $mod+m bar mode toggle
bindsym --release $mod+p exec polybar-msg cmd toggle

###################################
#            bindings             #
###################################

# Super/Win
set $mod Mod4
# Alt
#set $mod Mod1

# kill focused window
bindsym $mod+Shift+q kill
bindsym Mod1+F4 kill

bindsym $mod+Shift+Control+c reload
# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $mod+Shift+Control+r restart
# exit i3 (logs you out of your X session)
bindsym $mod+Shift+Control+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -b 'Yes, exit i3' 'i3-msg exit'"

# https://faq.i3wm.org/question/3747/enabling-multimedia-keys.1.html
# https://www.reddit.com/r/i3wm/comments/45yz3n/keyboard_media_keys_volume_control/
#bindsym XF86AudioRaiseVolume exec pactl set-sink-volume 1 +2% 
#bindsym XF86AudioLowerVolume exec pactl set-sink-volume 1 -2%
#bindsym XF86AudioMute exec pactl set-sink-mute 1 toggle
#bindsym XF86AudioPlay exec playerctl play-pause
#bindsym XF86AudioNext exec playerctl next
#bindsym XF86AudioPrev exec playerctl previous

bindsym XF86AudioRaiseVolume exec --no-startup-id $HOME/dotfiles/wms/commons/scripts/notify_volume + 5
bindsym XF86AudioLowerVolume exec --no-startup-id $HOME/dotfiles/wms/commons/scripts/notify_volume - 5
bindsym Shift+XF86AudioRaiseVolume exec --no-startup-id $HOME/dotfiles/wms/commons/scripts/notify_volume + 10
bindsym Shift+XF86AudioLowerVolume exec --no-startup-id $HOME/dotfiles/wms/commons/scripts/notify_volume - 10
bindsym XF86AudioMute exec --no-startup-id $HOME/dotfiles/wms/commons/scripts/notify_volume !

bindsym XF86MonBrightnessUp exec --no-startup-id $HOME/dotfiles/wms/i3/scripts/brightness +5
bindsym XF86MonBrightnessDown exec --no-startup-id $HOME/dotfiles/wms/i3/scripts/brightness -5

bindsym $mod+Shift+Control+l exec ~/dotfiles/bin/i3lock-fancy
bindsym $mod+Control+e exec "i3-nagbar -t warning -m 'Do you really want to lock i3?' -b 'Yes, lock i3' '~/dotfiles/bin/i3lock-fancy'"

#morc_menu
bindsym $mod+z exec $HOME/dotfiles/wms/commons/morc_menu/morc_menu/morc_menu

bindsym $mod+Control+n exec $HOME/dotfiles/wms/commons/networkmanager-dmenu/networkmanager_dmenu

# focus mode
# vertical horizontal
#bindsym $mod+q split vertical; mark lastsplit; exec /home/max/dotfiles/bin/i3wm-focus.sh/i3wm-focus
bindsym $mod+q exec /home/max/dotfiles/bin/i3wm-focus.sh/i3wm-focus
#bindsym $mod+q exec /home/max/dotfiles/bin/i3wm-focus.sh/i3wm-focus
#bindsym --release Caps_Lock exec pkill -SIGRTMIN+11 i3blocks

# https://community.spotify.com/t5/Desktop-Linux/Basic-controls-via-command-line/td-p/4295625
# https://wiki.debian.org/Keyboard/MultimediaKeys
bindsym --release XF86AudioPlay exec dbus-send --print-reply --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.PlayPause
bindsym --release XF86AudioPrev exec dbus-send --print-reply --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Previous
bindsym --release XF86AudioNext exec dbus-send --print-reply --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Next

bindsym $mod+Control+Return exec ~/dotfiles/bin/i3-sensible-terminal
#bindsym $mod+Shift+Return exec gnome-terminal
bindsym $mod+Return exec kitty
bindsym $mod+Shift+Return exec kitty

###################################
#              exec               #
###################################

exec --no-startup-id gnome-settings-daemon
exec gnome-keyring-daemon

# compositor
exec_always --no-startup-id picom -bc
# wallpaper
exec nitrogen --restore

# TODO: refactor/distro
exec --no-startup-id flameshot
exec --no-startup-id deadbeef
#exec --no-startup-id solus-update-checker

#exec_always --no-startup-id setxkbmap -option caps:escape

#exec --no-startup-id ~/dotfiles/bin/i3wm-xfsettings_launch
#exec --no-startup-id ~/.dropbox-dist/dropboxd

#exec_always --no-startup-id nm-applet
#exec_always --no-startup-id compton -f
#exec_always --no-startup-id compton -f --backend glx --unredir-if-possible --vsync opengl-swc

#exec --no-startup-id start-pulseaudio-x11
# Brasilia -l 15.8267:-47.9218
#exec --no-startup-id redshift-gtk -l 15.8267:-47.9218
#exec --no-startup-id /usr/bin/smbdb

# Podboat automatic queue and download
#exec_always --no-startup-id ~/dotfiles/bin/system-podentr

###################################
#              gaps               #
###################################

# https://github.com/nim-/dotfiles/blob/master/.i3/config (gaps)
# Airblader/i3

gaps inner 10
gaps outer 0
#smart_gaps on
smart_borders on

bindsym $mod+t		split toggle

bindsym $mod+Shift+w	resize grow width 10 px or 10 ppt
bindsym $mod+Shift+Control+w	resize shrink width 10 px or 10ppt

bindsym $mod+Shift+h	resize grow height 10 px or 10 ppt
bindsym $mod+Shift+Control+h	resize shrink height 10 px or 10 ppt




# FIXME: it's a mess
bindsym $mod+Shift+t	gaps inner all set 10; gaps outer all set 0
bindsym $mod+j		gaps inner current plus 5
bindsym $mod+Shift+j	gaps inner current minus 5

set $mode_gaps Gaps: (o) outer, (i) inner
set $mode_gaps_outer Outer Gaps: +|-|0 (local), Shift + +|-|0 (global)
set $mode_gaps_inner Inner Gaps: +|-|0 (local), Shift + +|-|0 (global)
bindsym $mod+g mode "$mode_gaps"

mode "$mode_gaps" {
        bindsym o      mode "$mode_gaps_outer"
        bindsym i      mode "$mode_gaps_inner"
        bindsym Return mode "default"
        bindsym Escape mode "default"
}

mode "$mode_gaps_inner" {
        bindsym plus  gaps inner current plus 5
        bindsym minus gaps inner current minus 5
        bindsym 0     gaps inner current set 0

        bindsym Shift+plus  gaps inner all plus 5
        bindsym Shift+minus gaps inner all minus 5
        bindsym Shift+0     gaps inner all set 0

        bindsym Return mode "default"
        bindsym Escape mode "default"
}

mode "$mode_gaps_outer" {
        bindsym plus  gaps outer current plus 5
        bindsym minus gaps outer current minus 5
        bindsym 0     gaps outer current set 0

        bindsym Shift+plus  gaps outer all plus 5
        bindsym Shift+minus gaps outer all minus 5
        bindsym Shift+0     gaps outer all set 0

        bindsym Return mode "default"
        bindsym Escape mode "default"
}

###################################
#              Modes              #
###################################

# https://wiki.archlinux.org/index.php/I3
set $mode_display Ext Screen (v) VGA ON, (h) HDMI ON, (x) VGA OFF, (y) HDMI OFF
mode "$mode_display" {
    bindsym v exec --no-startup-id xrandr --output VGA1 --auto --right-of LVDS1, mode "default"
    bindsym h exec --no-startup-id xrandr --output HDMI1 --auto --right-of LVDS1, mode "default"
    bindsym x exec --no-startup-id xrandr --output VGA1 --auto --off, mode "default"
    bindsym y exec --no-startup-id xrandr --output HDMI1 --auto --off, mode "default"

    # back to normal: Enter or Escape
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+x mode "$mode_display"

# resize window (you can also use the mouse for that)
mode "resize" {
  # These bindings trigger as soon as you enter the resize mode

  # Pressing left will shrink the window’s width.
  # Pressing right will grow the window’s width.
  # Pressing up will shrink the window’s height.
  # Pressing down will grow the window’s height.
  bindsym j resize shrink width 10 px or 10 ppt
  bindsym k resize grow height 10 px or 10 ppt
  bindsym l resize shrink height 10 px or 10 ppt
  bindsym semicolon resize grow width 10 px or 10 ppt

  # same bindings, but for the arrow keys
  bindsym Left resize shrink width 10 px or 10 ppt
  bindsym Down resize grow height 10 px or 10 ppt
  bindsym Up resize shrink height 10 px or 10 ppt
  bindsym Right resize grow width 10 px or 10 ppt

  # back to normal: Enter or Escape
  bindsym Return mode "default"
  bindsym Escape mode "default"
}
bindsym $mod+r mode "resize"

set $mode_system System (0) reload i3, (l) lock , (e) logout , (s) suspend  , (h) hibernate  , (r) reboot   , (Shift+s) shutdown 
mode "$mode_system" {
  bindsym 0 exec --no-startup-id i3 reload, mode "default"
  bindsym l exec --no-startup-id ~/dotfiles/bin/i3exit lock, mode "default"
  bindsym e exec --no-startup-id ~/dotfiles/bin/i3exit logout, mode "default"
  bindsym s exec --no-startup-id ~/dotfiles/bin/i3exit suspend, mode "default"
  bindsym h exec --no-startup-id ~/dotfiles/bin/i3exit hibernate, mode "default"
  bindsym r exec --no-startup-id ~/dotfiles/bin/i3exit reboot, mode "default"
  bindsym Shift+s exec --no-startup-id ~/dotfiles/bin/i3exit shutdown, mode "default"
  
  # back to normal: Enter or Escape
  bindsym Return mode "default"
  bindsym Escape mode "default"
}
bindsym --release XF86PowerOff mode "$mode_system"

#bindsym $mod+Shift+Control+F12 exec i3-msg exit

# https://www.reddit.com/r/i3wm/comments/77mqxa/bindsym_power_button/
exec --no-startup-id systemd-inhibit --what=handle-power-key sleep infinity

###################################
#               rofi              #
###################################

bindsym $mod+Control+d exec rofi -show run -p "λ run: " -fullscreen -scrollbar-width 70 -sidebar-mode -eh 1  -bc "#6C9565"

bindsym $mod+space exec rofi -show run -p "λ run: " -fullscreen -scrollbar-width 70 -sidebar-mode -eh 1  -bc "#6C9565"

bindsym $mod+d exec rofi -theme sidebar -show drun & sleep 0.3 && xprop -f -name rofi

bindsym $mod+Control+w exec rofi -show window -p "λ window: " -fullscreen -scrollbar-width 70 -sidebar-mode -eh 1 -columns 1 -bc "#6C9565"

bindsym $mod+Control+s exec rofi -show ssh -p "λ ssh: " -fullscreen -scrollbar-width 70 -sidebar-mode -eh 1 -columns 1 -bc "#6C9565"

###################################
#           scratchpad            #
###################################

bindsym $mod+slash move scratchpad
bindsym $mod+backslash scratchpad show

exec --no-startup-id kitty --detach --session $HOME/.config/kitty/sessions/kitty-monitor-sessions
#exec --no-startup-id kitty --detach --session $HOME/dotfiles/apps/kitty/session-sys-mon
#exec --no-startup-id kitty --detach --session $HOME/dotfiles/apps/kitty/session-dotfiles
for_window [title="scratch_pad_iotop"] move scratchpad
bindsym $mod+Shift+d [title="scratch-dotfiles"] scratchpad show

#exec --no-startup-id kitty --detach --session $HOME/dotfiles/apps/kitty/session-newsboat
#for_window [title="scratch-newsboat"] move scratchpad
#bindsym $mod+Shift+n [title="scratch-newsboat"] scratchpad show


###################################
#               ui                #
###################################

set_from_resource        $foreground foreground #8Cf595
set_from_resource        $background background #2b2b2b
set_from_resource        $foreground-unfocused foreground-unfocused #6C9565

set_from_resource        $primary primary #ffb52a
set_from_resource        $alert alert #ffb52a
# windows title bar colors
                          # border    background  text
client.focused            $primary    $background $foreground
client.unfocused          $background $background $foreground
client.focused_inactive	  $primary    $primary    #000000
client.urgent             $background $alert      $foreground

font xft:FontAwesome 10.3

######################################
#         window management          #
######################################

# enter fullscreen mode for the focused container
bindsym $mod+f fullscreen

# window change focus
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# move focused window
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# container splitting
# split in horizontal orientation
bindsym $mod+h split h

# split in vertical orientation
bindsym $mod+v split v

# change container layout (stacked, tabbed, toggle split)
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# toggle tiling / floating
bindsym $mod+Shift+space floating toggle

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

# change focus between tiling / floating windows
#bindsym $mod+space focus mode_toggle

# toggle between stacking/tabbed/split/splith/splitv
bindsym $mod+l layout toggle all

# toggle borders
bindsym $mod+b border toggle

# focus the parent container
bindsym $mod+a focus parent

# focus the child container
#bindsym $mod+d focus child

# new window defaults
new_window pixel 2 
new_float pixel 2
hide_edge_borders both

for_window [class="^.*"] border pixel 2
for_window [window_role="pop-up"] floating enable;border normal
for_window [window_role="task_dialog"] floating enable;border normal

######################################
#            workspaces              #
######################################

# navigation
# prev next workspace
bindsym $mod+comma workspace prev
bindsym $mod+period workspace next

# tab between recent workspaces
bindsym $mod+Tab workspace back_and_forth
# next/previous workspace
bindsym Mod1+Tab workspace next
bindsym Mod1+Shift+Tab workspace prev
#bindsym Ctrl+Mod1+Left workspace prev
#bindsym Ctrl+Mod1+Right workspace next
# move focused workspace between monitors
# (i3-msg) move workspace to output left|right|down|up|current|primary|<output>
bindsym $mod+Ctrl+greater move workspace to output right
bindsym $mod+Ctrl+less move workspace to output left

# setting workspaces variables
set $ws1 "1:"
set $ws2 "2:"
set $ws3 "3:"
set $ws4 "4:"
set $ws5 "5:"
set $ws6  "6:"
set $ws7  "7:"
set $ws8  "8:  "
set $ws9  "9:  "
set $ws10 "10:"

bindsym $mod+1 workspace $ws1
bindsym $mod+2 workspace $ws2
bindsym $mod+3 workspace $ws3
bindsym $mod+4 workspace $ws4
bindsym $mod+5 workspace $ws5
bindsym $mod+6 workspace $ws6
bindsym $mod+7 workspace 7
bindsym $mod+8 workspace 8
bindsym $mod+9 workspace 9
bindsym $mod+0 workspace $ws10

# move focused container to workspace
bindsym $mod+Shift+1 move container to workspace $ws1
bindsym $mod+Shift+2 move container to workspace $ws2
bindsym $mod+Shift+3 move container to workspace $ws3
bindsym $mod+Shift+4 move container to workspace $ws4
bindsym $mod+Shift+5 move container to workspace $ws5
bindsym $mod+Shift+6 move container to workspace 6
bindsym $mod+Shift+7 move container to workspace 7
bindsym $mod+Shift+8 move container to workspace 8
bindsym $mod+Shift+9 move container to workspace 9
bindsym $mod+Shift+0 move container to workspace $ws10


######################################
#            kde/plasma              #
######################################
#assign [title="Desktop — Plasma"] $ws9
#for_window [title="Desktop — Plasma"] move to workspace $ws9
 
# https://userbase.kde.org/Tutorials/Using_Other_Window_Managers_with_Plasma
# https://github.com/heckelson/i3-and-kde-plasma

exec --no-startup-id wmctrl -c Plasma
#for_window [title="Desktop — Plasma"] kill; floating enable; border none
for_window [title="Desktop — Plasma"] kill; floating enable, move right -1000px; border none
for_window [class="plasmashell"] floating enable, move right 1px;
for_window [class="Plasma"] floating enable; border none
for_window [title="plasma-desktop"] floating enable; border none
for_window [class="plasmashell" window_type="notification"] floating enable, border none, move right 700px, move down 150px
no_focus [class="plasmashell" window_type="notification"] 

for_window [class="krunner"] floating enable; border none

#for_window [title="win7"] floating enable; border none
#for_window [class="Kmix"] floating enable; border none
#for_window [class="Klipper"] floating enable; border none
#for_window [class="Plasmoidviewer"] floating enable; border none
#for_window [class="(?i)*nextcloud*"] floating disable

# >>> Avoid tiling for non-Plasma stuff <<<
for_window [window_role="pop-up"] floating enable
for_window [window_role="bubble"] floating enable
for_window [window_role="task_dialog"] floating enable
for_window [window_role="Preferences"] floating enable
for_window [window_role="About"] floating enable 
for_window [window_type="dialog"] floating enable
for_window [window_type="menu"] floating enable

no_focus [class=”plasmashell”]

force_display_urgency_hint 0 ms
focus_on_window_activation urgent

# using plasma's logout screen instead of i3's
bindsym $mod+Shift+e exec --no-startup-id qdbus org.kde.ksmserver /KSMServer org.kde.KSMServerInterface.logout -1 -1 -1

## krunner
bindsym $mod+o exec qdbus org.kde.kglobalaccel /component/krunner org.kde.kglobalaccel.Component.invokeShortcut 'run command' 

#bindsym $mod+control+shift+Return exec plasmashell

# Alt+F3
bindsym Mod1+F3 exec --no-startup-id qdbus org.kde.plasmashell /PlasmaShell org.kde.PlasmaShell.activateLauncherMenu
